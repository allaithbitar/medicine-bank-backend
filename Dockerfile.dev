FROM oven/bun:1.2.18-alpine AS base

WORKDIR /app

# Install dependencies in the image for self-contained setup
COPY package.json bun.lock ./
RUN bun install

# Source code will be mounted via volume for hot reload
# So we don't copy ./src or other source files here

ARG POSTGRES_HOST

ARG POSTGRES_PORT

ARG POSTGRES_USER

ARG POSTGRES_DB

ARG POSTGRES_PASSWORD 

ARG PORT

ENV POSTGRES_HOST=$POSTGRES_HOST

ENV POSTGRES_PORT=$POSTGRES_PORT

ENV POSTGRES_USER=$POSTGRES_USER

ENV POSTGRES_DB=$POSTGRES_DB

ENV POSTGRES_PASSWORD=$POSTGRES_PASSWORD 

ENV PORT=$PORT

CMD ["bun", "run", "dev"]
