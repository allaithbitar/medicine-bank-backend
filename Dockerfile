FROM oven/bun:1.2.18-alpine AS base


WORKDIR /app

COPY package.json bun.lock  .


RUN bun install

COPY ./src ./src

ARG POSTGRES_HOST

ARG POSTGRES_PORT

ARG POSTGRES_USER

ARG POSTGRES_DB

ARG POSTGRES_PASSWORD 

ARG JWT_SECRET

ARG JWT_TOKEN_EXPIRE

ARG JWT_REFRESH_TOKEN_EXPIRE

ARG PORT

ARG USE_HTTPS

ARG SSL_CERT_PATH

ARG SSL_KEY_PATH

ENV POSTGRES_HOST=$POSTGRES_HOST

ENV POSTGRES_PORT=$POSTGRES_PORT

ENV POSTGRES_USER=$POSTGRES_USER

ENV POSTGRES_DB=$POSTGRES_DB

ENV POSTGRES_PASSWORD=$POSTGRES_PASSWORD 

ENV JWT_SECRET=$JWT_SECRET 

ENV JWT_TOKEN_EXPIRE=$JWT_TOKEN_EXPIRE 

ENV JWT_REFRESH_TOKEN_EXPIRE=$JWT_REFRESH_TOKEN_EXPIRE 

ENV PORT=$PORT 

ENV USE_HTTPS=$USE_HTTPS

ENV SSL_CERT_PATH=$SSL_CERT_PATH

ENV SSL_KEY_PATH=$SSL_KEY_PATH

ENV NODE_ENV="production"

RUN bun run build

CMD ["bun", "run", "start"]
